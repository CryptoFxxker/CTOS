{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="kline-container">
  <div class="indicator-header">
    <div class="breadcrumb">
      <a href="{% url 'metrics_home' %}">指标中心</a>
      <span class="separator">></span>
      <span class="current">K线图</span>
    </div>
    
    <div class="indicator-info">
      <h2>K线图分析</h2>
      <p>单个币种的详细K线图展示</p>
    </div>
  </div>

  <div class="controls-panel">
    <div class="control-group">
      <label for="coin-select">币种:</label>
      <select id="coin-select">
        {% for coin in coins %}
        <option value="{{ coin }}" {% if coin == "btc" %}selected{% endif %}>{{ coin|upper }}</option>
        {% endfor %}
      </select>
    </div>
    
    <div class="control-group">
      <label for="timeframe-select">时间框架:</label>
      <select id="timeframe-select">
        {% for timeframe in timeframes %}
        <option value="{{ timeframe }}" {% if timeframe == "1h" %}selected{% endif %}>{{ timeframe|upper }}</option>
        {% endfor %}
      </select>
    </div>
    
    <div class="control-group">
      <button id="refresh-btn" class="btn btn-primary">
        <span class="refresh-icon">🔄</span>
        手动刷新
      </button>
    </div>
    
    <div class="control-group">
      <label>
        <input type="checkbox" id="auto-refresh-checkbox" checked>
        自动刷新 (10秒)
      </label>
    </div>
  </div>

  <div class="chart-container">
    <div class="chart-card">
      <div class="chart-header">
        <h3 id="chart-title">K线图 - BTC 1H</h3>
      </div>
      <div class="chart-content">
        <img id="chart-image" src="" alt="K线图" class="chart-image">
      </div>
      <div class="chart-footer">
        <span class="chart-timestamp">最后更新: <span id="last-update">-</span></span>
      </div>
    </div>
  </div>

  <div class="loading-overlay" id="loading-overlay">
    <div class="loading-spinner"></div>
    <p>正在加载图表...</p>
  </div>
</div>

<script src="{% static 'js/kline.js' %}"></script>
<script>
  // 传递配置给JavaScript
  window.klineConfig = {
    timeframes: {{ timeframes|safe }},
    coins: {{ coins|safe }},
    indicatorId: '{{ indicator_id }}'
  };
</script>
{% endblock %}
