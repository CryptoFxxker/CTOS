{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="kline-container">
  <div class="indicator-header">
    <div class="breadcrumb">
      <a href="{% url 'metrics_home' %}">æŒ‡æ ‡ä¸­å¿ƒ</a>
      <span class="separator">></span>
      <span class="current">Kçº¿å›¾</span>
    </div>
    
    <div class="indicator-info">
      <h2>Kçº¿å›¾åˆ†æ</h2>
      <p>å•ä¸ªå¸ç§çš„è¯¦ç»†Kçº¿å›¾å±•ç¤º</p>
    </div>
  </div>

  <div class="controls-panel">
    <div class="control-group">
      <label for="coin-select">å¸ç§:</label>
      <select id="coin-select">
        <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
      </select>
    </div>
    
    <div class="control-group">
      <label for="timeframe-select">æ—¶é—´æ¡†æ¶:</label>
      <select id="timeframe-select">
        <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
      </select>
    </div>
    
    <div class="control-group">
      <button id="refresh-btn" class="btn btn-primary">
        <span class="refresh-icon">ğŸ”„</span>
        æ‰‹åŠ¨åˆ·æ–°
      </button>
    </div>
    
    <div class="control-group">
      <label>
        <input type="checkbox" id="auto-refresh-checkbox" checked>
        è‡ªåŠ¨åˆ·æ–° (10ç§’)
      </label>
    </div>
  </div>

  <div class="chart-container">
    <div class="chart-card">
      <div class="chart-header">
        <h3 id="chart-title">Kçº¿å›¾ - BTC 1H</h3>
      </div>
      <div class="chart-content">
        <canvas id="kline-chart" style="width: 100%; height: 500px;"></canvas>
      </div>
      <div class="chart-footer">
        <span class="chart-timestamp">æœ€åæ›´æ–°: <span id="last-update">-</span></span>
      </div>
    </div>
  </div>

  <div class="loading-overlay" id="loading-overlay" style="display: none; opacity: 0; transition: opacity 0.3s ease;">
    <div class="loading-spinner"></div>
    <p>æ­£åœ¨åŠ è½½å›¾è¡¨...</p>
  </div>
</div>

<style>
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.95);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  transition: opacity 0.3s ease;
}

.loading-spinner {
  border: 4px solid #f3f3f3;
  border-top: 4px solid #667eea;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
  margin-bottom: 1rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.refresh-indicator {
  display: inline-block;
  animation: spin 1s linear infinite;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.1/dist/chartjs-chart-financial.min.js"></script>
<script src="{% static 'js/kline.js' %}"></script>
<script>
  // ä¼ é€’é…ç½®ç»™JavaScript
  window.klineConfig = {
    timeframes: {{ timeframes|safe }},
    coins: {{ coins|safe }},
    indicatorId: '{{ indicator_id }}'
  };
</script>
{% endblock %}
