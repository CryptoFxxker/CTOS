# CTOS ç½‘ç«™å¿«é€Ÿæ­å»ºæ–¹æ¡ˆ

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

åŸºäºç°æœ‰ Django æ¶æ„ï¼Œæä¾›ä¸€å¥—å®Œæ•´çš„ç½‘ç«™æ­å»ºæ–¹æ¡ˆï¼ŒåŒ…æ‹¬ç¯å¢ƒé…ç½®ã€ä¾èµ–å®‰è£…ã€æ•°æ®åº“åˆå§‹åŒ–ã€æœåŠ¡å¯åŠ¨ç­‰å…¨æµç¨‹ã€‚

---

## ğŸ—ï¸ æ¶æ„åˆ†æ

### å½“å‰æ¶æ„ç»„æˆ

```
CTOS Website
â”œâ”€â”€ Django 4.2 æ¡†æ¶
â”œâ”€â”€ åº”ç”¨æ¨¡å—
â”‚   â”œâ”€â”€ accounts/      # è´¦æˆ·ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ metrics/       # æŒ‡æ ‡åˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ strategies/    # ç­–ç•¥ç®¡ç†æ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â””â”€â”€ trading/       # äº¤æ˜“æ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰
â”œâ”€â”€ æ ¸å¿ƒä¾èµ–
â”‚   â”œâ”€â”€ AccountManager # è´¦æˆ·ç®¡ç†å™¨ï¼ˆctos/core/runtime/ï¼‰
â”‚   â”œâ”€â”€ AccountReader  # é…ç½®è¯»å–å™¨ï¼ˆconfigs/ï¼‰
â”‚   â””â”€â”€ Exchange Drivers # äº¤æ˜“æ‰€é©±åŠ¨ï¼ˆOKXã€Backpackï¼‰
â””â”€â”€ é™æ€èµ„æº
    â”œâ”€â”€ static/        # CSSã€JSã€å›¾ç‰‡
    â””â”€â”€ templates/     # HTML æ¨¡æ¿
```

### æŠ€æœ¯æ ˆ

- **åç«¯**: Django 4.2, Python 3.8+
- **æ•°æ®åº“**: SQLiteï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- **å‰ç«¯**: HTML5/CSS3/JavaScript (ES6+)
- **æ ¸å¿ƒç»„ä»¶**: AccountManager, Exchange Drivers

---

## ğŸš€ å¿«é€Ÿæ­å»ºæ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡

#### 1.1 Python ç¯å¢ƒæ£€æŸ¥

```bash
# æ£€æŸ¥ Python ç‰ˆæœ¬ï¼ˆéœ€è¦ 3.8+ï¼‰
python3 --version

# å¦‚æœæœªå®‰è£…ï¼Œä½¿ç”¨ conda åˆ›å»ºç¯å¢ƒ
conda create -n ctos-website python=3.10
conda activate ctos-website
```

#### 1.2 é¡¹ç›®è·¯å¾„ç¡®è®¤

```bash
# ç¡®è®¤é¡¹ç›®æ ¹ç›®å½•ç»“æ„
cd /home/zzb/Quantify/ctos
ls -la

# åº”è¯¥çœ‹åˆ°ä»¥ä¸‹ç›®å½•ï¼š
# - apps/website/     # Django é¡¹ç›®
# - ctos/            # æ ¸å¿ƒä»£ç 
# - configs/         # é…ç½®æ–‡ä»¶
```

---

### ç¬¬äºŒæ­¥ï¼šä¾èµ–å®‰è£…

#### 2.1 åˆ›å»º requirements.txt

åœ¨ `apps/website/` ç›®å½•ä¸‹åˆ›å»º `requirements.txt`ï¼š

```txt
Django>=4.2.0,<5.0.0
# å…¶ä»–ä¾èµ–æ ¹æ®å®é™…éœ€è¦æ·»åŠ 
```

#### 2.2 å®‰è£…ä¾èµ–

```bash
cd /home/zzb/Quantify/ctos/apps/website
pip install -r requirements.txt
```

---

### ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ£€æŸ¥

#### 3.1 æ£€æŸ¥ Django é…ç½®

ç¡®è®¤ `website/settings.py` é…ç½®æ­£ç¡®ï¼š

- âœ… `DEBUG = True`ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- âœ… `ALLOWED_HOSTS` åŒ…å«æœåŠ¡å™¨ IP
- âœ… `INSTALLED_APPS` åŒ…å«æ‰€æœ‰åº”ç”¨
- âœ… `STATIC_URL` å’Œ `STATICFILES_DIRS` é…ç½®æ­£ç¡®

#### 3.2 æ£€æŸ¥è´¦æˆ·é…ç½®

ç¡®è®¤ `configs/account_reader.py` å’Œè´¦æˆ·é…ç½®æ–‡ä»¶å­˜åœ¨ï¼š

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
ls -la /home/zzb/Quantify/ctos/configs/
```

#### 3.3 æ£€æŸ¥æ ¸å¿ƒæ¨¡å—è·¯å¾„

ç¡®è®¤ Python å¯ä»¥å¯¼å…¥æ ¸å¿ƒæ¨¡å—ï¼š

```bash
cd /home/zzb/Quantify/ctos/apps/website
python3 -c "import sys; sys.path.insert(0, '/home/azureuser/Quantify/ctos'); from ctos.core.runtime.AccountManager import get_account_manager; print('å¯¼å…¥æˆåŠŸ')"
```

---

### ç¬¬å››æ­¥ï¼šæ•°æ®åº“åˆå§‹åŒ–

#### 4.1 æ‰§è¡Œæ•°æ®åº“è¿ç§»

```bash
cd /home/zzb/Quantify/ctos/apps/website
python manage.py migrate
```

#### 4.2 åˆ›å»ºè¶…çº§ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰

```bash
python manage.py createsuperuser
```

---

### ç¬¬äº”æ­¥ï¼šé™æ€æ–‡ä»¶æ”¶é›†

#### 5.1 æ£€æŸ¥é™æ€æ–‡ä»¶ç›®å½•

```bash
# ç¡®è®¤ static ç›®å½•å­˜åœ¨
ls -la /home/zzb/Quantify/ctos/apps/website/static/
```

#### 5.2 æ”¶é›†é™æ€æ–‡ä»¶ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

```bash
python manage.py collectstatic --noinput
```

---

### ç¬¬å…­æ­¥ï¼šå¯åŠ¨æœåŠ¡

#### 6.1 å¼€å‘ç¯å¢ƒå¯åŠ¨

```bash
cd /home/zzb/Quantify/ctos/apps/website
python manage.py runserver 0.0.0.0:8000
```

#### 6.2 ç”Ÿäº§ç¯å¢ƒå¯åŠ¨ï¼ˆä½¿ç”¨ Gunicornï¼‰

```bash
# å®‰è£… Gunicorn
pip install gunicorn

# å¯åŠ¨æœåŠ¡
gunicorn website.wsgi:application --bind 0.0.0.0:8000 --workers 4
```

#### 6.3 ä½¿ç”¨ systemd ç®¡ç†æœåŠ¡ï¼ˆæ¨èï¼‰

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/ctos-website.service`ï¼š

```ini
[Unit]
Description=CTOS Website Django Application
After=network.target

[Service]
User=azureuser
Group=azureuser
WorkingDirectory=/home/zzb/Quantify/ctos/apps/website
Environment="PATH=/home/zzb/anaconda3/envs/ctos-website/bin"
ExecStart=/home/zzb/anaconda3/envs/ctos-website/bin/gunicorn website.wsgi:application --bind 0.0.0.0:8000 --workers 4
Restart=always

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
sudo systemctl daemon-reload
sudo systemctl enable ctos-website
sudo systemctl start ctos-website
sudo systemctl status ctos-website
```

---

## ğŸ”§ é…ç½®ä¼˜åŒ–

### å¼€å‘ç¯å¢ƒé…ç½®

åœ¨ `website/settings.py` ä¸­ï¼š

```python
DEBUG = True
ALLOWED_HOSTS = ['localhost', '127.0.0.1', 'ä½ çš„æœåŠ¡å™¨IP']
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®

```python
DEBUG = False
ALLOWED_HOSTS = ['ä½ çš„åŸŸå', 'ä½ çš„æœåŠ¡å™¨IP']
SECURE_SSL_REDIRECT = True  # å¦‚æœä½¿ç”¨ HTTPS
SESSION_COOKIE_SECURE = True
CSRF_COOKIE_SECURE = True
```

### æ•°æ®åº“é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

å¦‚æœéœ€è¦ä½¿ç”¨ PostgreSQLï¼š

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'ctos_db',
        'USER': 'ctos_user',
        'PASSWORD': 'your_password',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}
```

---

## ğŸ“ éªŒè¯æ¸…å•

### å¯åŠ¨å‰æ£€æŸ¥

- [ ] Python 3.8+ å·²å®‰è£…
- [ ] Django 4.2 å·²å®‰è£…
- [ ] é¡¹ç›®è·¯å¾„æ­£ç¡®
- [ ] æ ¸å¿ƒæ¨¡å—å¯ä»¥å¯¼å…¥
- [ ] è´¦æˆ·é…ç½®æ–‡ä»¶å­˜åœ¨
- [ ] æ•°æ®åº“è¿ç§»å®Œæˆ
- [ ] é™æ€æ–‡ä»¶ç›®å½•å­˜åœ¨

### å¯åŠ¨åéªŒè¯

- [ ] è®¿é—® `http://æœåŠ¡å™¨IP:8000` æ˜¾ç¤ºé¦–é¡µ
- [ ] è®¿é—® `/accounts/` æ˜¾ç¤ºè´¦æˆ·åˆ—è¡¨
- [ ] è®¿é—® `/metrics/` æ˜¾ç¤ºæŒ‡æ ‡é¡µé¢
- [ ] è´¦æˆ·æ•°æ®å¯ä»¥æ­£å¸¸åŠ è½½
- [ ] é™æ€èµ„æºï¼ˆCSS/JSï¼‰æ­£å¸¸åŠ è½½

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šæ¨¡å—å¯¼å…¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ModuleNotFoundError: No module named 'ctos'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ³•1ï¼šåœ¨ manage.py æˆ– views.py ä¸­æ·»åŠ è·¯å¾„
import sys
sys.path.insert(0, '/home/zzb/Quantify/ctos')

# æ–¹æ³•2ï¼šè®¾ç½® PYTHONPATH
export PYTHONPATH=/home/zzb/Quantify/ctos:$PYTHONPATH
```

### é—®é¢˜2ï¼šYAML æ¨¡å—ç¼ºå¤±

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ModuleNotFoundError: No module named 'yaml'
ERROR: Could not find a version that satisfies the requirement yaml
```

**åŸå› **ï¼š
- `account_reader.py` éœ€è¦ `yaml` æ¨¡å—æ¥è§£æ YAML é…ç½®æ–‡ä»¶
- æ­£ç¡®çš„åŒ…åæ˜¯ `PyYAML`ï¼Œä¸æ˜¯ `yaml`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å®‰è£… PyYAMLï¼ˆæ³¨æ„åŒ…åæ˜¯ PyYAMLï¼Œä¸æ˜¯ yamlï¼‰
pip install PyYAML

# æˆ–å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt
```

**éªŒè¯**ï¼š
```bash
python3 -c "import yaml; print('PyYAML å®‰è£…æˆåŠŸ')"
```

### é—®é¢˜3ï¼šè´¦æˆ·åˆå§‹åŒ–å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Backpackè´¦æˆ· X åˆå§‹åŒ–å¤±è´¥
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `configs/` ç›®å½•ä¸‹çš„è´¦æˆ·é…ç½®æ–‡ä»¶
2. ç¡®è®¤ API å¯†é’¥é…ç½®æ­£ç¡®
3. æ£€æŸ¥ç½‘ç»œè¿æ¥
4. æŸ¥çœ‹æ—¥å¿—è¾“å‡º

### é—®é¢˜4ï¼šé™æ€æ–‡ä»¶404

**é”™è¯¯ä¿¡æ¯**ï¼š
```
GET /static/css/style.css 404 (Not Found)
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. ç¡®è®¤ STATICFILES_DIRS é…ç½®
# 2. å¼€å‘ç¯å¢ƒä½¿ç”¨ runserver ä¼šè‡ªåŠ¨å¤„ç†
# 3. ç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½® Nginx æˆ–æ”¶é›†é™æ€æ–‡ä»¶
python manage.py collectstatic
```

### é—®é¢˜5ï¼šç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: That port is already in use.
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :8000
# æˆ–
netstat -tulpn | grep 8000

# æ€æ­»è¿›ç¨‹
kill -9 <PID>
```

---

## ğŸ” å®‰å…¨å»ºè®®

### 1. å¯†é’¥ç®¡ç†

- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- âœ… ä¸è¦å°† API å¯†é’¥æäº¤åˆ° Git
- âœ… ä½¿ç”¨ `.env` æ–‡ä»¶ç®¡ç†é…ç½®

### 2. Django å®‰å…¨è®¾ç½®

```python
# settings.py
SECRET_KEY = os.environ.get('SECRET_KEY')
DEBUG = False  # ç”Ÿäº§ç¯å¢ƒ
ALLOWED_HOSTS = ['your-domain.com']
```

### 3. HTTPS é…ç½®

ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ Nginx + SSL è¯ä¹¦ï¼š

```nginx
server {
    listen 443 ssl;
    server_name your-domain.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /static/ {
        alias /path/to/static/;
    }
}
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–

- ä½¿ç”¨æ•°æ®åº“ç´¢å¼•
- ä¼˜åŒ–æŸ¥è¯¢ï¼ˆä½¿ç”¨ `select_related`ã€`prefetch_related`ï¼‰
- è€ƒè™‘ä½¿ç”¨ç¼“å­˜ï¼ˆRedisï¼‰

### 2. é™æ€èµ„æºä¼˜åŒ–

- ä½¿ç”¨ CDN åŠ é€Ÿ
- å‹ç¼© CSS/JS æ–‡ä»¶
- å¯ç”¨æµè§ˆå™¨ç¼“å­˜

### 3. åº”ç”¨ä¼˜åŒ–

- ä½¿ç”¨ Gunicorn + Nginx
- é…ç½®é€‚å½“çš„ worker æ•°é‡
- ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼ˆRedis/Memcachedï¼‰

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨è„šæœ¬

åˆ›å»º `start.sh` è„šæœ¬ï¼š

```bash
#!/bin/bash

# CTOS Website å¿«é€Ÿå¯åŠ¨è„šæœ¬

PROJECT_DIR="/home/zzb/Quantify/ctos/apps/website"
PYTHON_ENV="/home/zzb/anaconda3/envs/ctos-website"

cd $PROJECT_DIR

# æ¿€æ´»ç¯å¢ƒ
source $PYTHON_ENV/bin/activate

# æ£€æŸ¥æ•°æ®åº“
python manage.py migrate

# å¯åŠ¨æœåŠ¡
if [ "$1" == "prod" ]; then
    echo "å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ..."
    gunicorn website.wsgi:application --bind 0.0.0.0:8000 --workers 4
else
    echo "å¯åŠ¨å¼€å‘ç¯å¢ƒ..."
    python manage.py runserver 0.0.0.0:8000
fi
```

ä½¿ç”¨æ–¹å¼ï¼š

```bash
chmod +x start.sh
./start.sh        # å¼€å‘ç¯å¢ƒ
./start.sh prod   # ç”Ÿäº§ç¯å¢ƒ
```

---

## ğŸ“š åç»­å¼€å‘å»ºè®®

### 1. å®Œå–„åŠŸèƒ½æ¨¡å—

- [ ] å®ç° `strategies` åº”ç”¨
- [ ] å®ç° `trading` åº”ç”¨
- [ ] æ·»åŠ ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- [ ] æ·»åŠ æƒé™ç®¡ç†

### 2. å¢å¼ºåŠŸèƒ½

- [ ] å®æ—¶æ•°æ®æ¨é€ï¼ˆWebSocketï¼‰
- [ ] æ•°æ®å¯è§†åŒ–å¢å¼º
- [ ] ç­–ç•¥å›æµ‹åŠŸèƒ½
- [ ] æ—¥å¿—ç®¡ç†ç³»ç»Ÿ

### 3. è¿ç»´æ”¹è¿›

- [ ] æ·»åŠ ç›‘æ§å‘Šè­¦
- [ ] æ—¥å¿—è½®è½¬é…ç½®
- [ ] è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- [ ] å¤‡ä»½æ¢å¤æ–¹æ¡ˆ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. Django æ—¥å¿—è¾“å‡º
2. ç³»ç»Ÿæ—¥å¿—ï¼š`journalctl -u ctos-website`
3. Nginx æ—¥å¿—ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
4. æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

---

**æœ€åæ›´æ–°**: 2024-12-02
**ç‰ˆæœ¬**: v1.0.0

