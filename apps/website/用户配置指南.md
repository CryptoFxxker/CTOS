# CTOS ç½‘ç«™ç”¨æˆ·é…ç½®æŒ‡å—

## ğŸ“‹ ç”¨æˆ·åˆ›å»ºæ–¹æ³•

Django é»˜è®¤è®¤è¯ç³»ç»Ÿæä¾›äº†å¤šç§åˆ›å»ºç”¨æˆ·çš„æ–¹æ³•ï¼Œä½ å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹å¼ã€‚

---

## æ–¹æ³• 1ï¼šä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºè¶…çº§ç”¨æˆ·ï¼ˆæ¨èï¼‰

### æ­¥éª¤

1. **è¿›å…¥é¡¹ç›®ç›®å½•**
```bash
cd /home/zzb/Quantify/ctos/apps/website
```

2. **æ‰§è¡Œåˆ›å»ºå‘½ä»¤**
```bash
python manage.py createsuperuser
```

3. **æŒ‰æç¤ºè¾“å…¥ä¿¡æ¯**
```
ç”¨æˆ·å (leave blank to use 'azureuser'): admin
ç”µå­é‚®ä»¶åœ°å€: admin@example.com
Password: 
Password (again): 
Superuser created successfully.
```

### ç‰¹ç‚¹
- âœ… æœ€ç®€å•å¿«é€Ÿ
- âœ… åˆ›å»ºçš„æ˜¯è¶…çº§ç”¨æˆ·ï¼ˆæ‹¥æœ‰æ‰€æœ‰æƒé™ï¼‰
- âœ… å¯ä»¥è®¿é—® Django Admin åå°

---

## æ–¹æ³• 2ï¼šä½¿ç”¨ Django Admin åå°

### æ­¥éª¤

1. **åˆ›å»ºè¶…çº§ç”¨æˆ·**ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
```bash
python manage.py createsuperuser
```

2. **å¯åŠ¨æœåŠ¡å™¨**
```bash
python manage.py runserver 0.0.0.0:8000
```

3. **è®¿é—® Admin åå°**
```
http://ä½ çš„æœåŠ¡å™¨IP:8000/admin/
```

4. **ç™»å½•ååˆ›å»ºç”¨æˆ·**
   - ç‚¹å‡» "Users" â†’ "Add user"
   - è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
   - ä¿å­˜åå¯ä»¥ç¼–è¾‘ç”¨æˆ·è¯¦ç»†ä¿¡æ¯

### ç‰¹ç‚¹
- âœ… å›¾å½¢ç•Œé¢ï¼Œæ“ä½œç›´è§‚
- âœ… å¯ä»¥æ‰¹é‡ç®¡ç†ç”¨æˆ·
- âœ… å¯ä»¥è®¾ç½®ç”¨æˆ·æƒé™å’Œç»„

---

## æ–¹æ³• 3ï¼šä½¿ç”¨ Django Shell åˆ›å»ºç”¨æˆ·

### åˆ›å»ºæ™®é€šç”¨æˆ·

```bash
cd /home/zzb/Quantify/ctos/apps/website
python manage.py shell
```

ç„¶ååœ¨ Python shell ä¸­æ‰§è¡Œï¼š

```python
from django.contrib.auth.models import User

# åˆ›å»ºæ™®é€šç”¨æˆ·
user = User.objects.create_user(
    username='testuser',
    email='test@example.com',
    password='your_password_here'
)
print(f"ç”¨æˆ· {user.username} åˆ›å»ºæˆåŠŸï¼")
```

### åˆ›å»ºè¶…çº§ç”¨æˆ·

```python
from django.contrib.auth.models import User

# åˆ›å»ºè¶…çº§ç”¨æˆ·
superuser = User.objects.create_superuser(
    username='admin2',
    email='admin2@example.com',
    password='your_password_here'
)
print(f"è¶…çº§ç”¨æˆ· {superuser.username} åˆ›å»ºæˆåŠŸï¼")
```

### æ‰¹é‡åˆ›å»ºç”¨æˆ·

```python
from django.contrib.auth.models import User

users_data = [
    {'username': 'user1', 'email': 'user1@example.com', 'password': 'pass123'},
    {'username': 'user2', 'email': 'user2@example.com', 'password': 'pass123'},
    {'username': 'user3', 'email': 'user3@example.com', 'password': 'pass123'},
]

for user_data in users_data:
    user = User.objects.create_user(**user_data)
    print(f"ç”¨æˆ· {user.username} åˆ›å»ºæˆåŠŸï¼")
```

### ç‰¹ç‚¹
- âœ… é€‚åˆæ‰¹é‡åˆ›å»º
- âœ… å¯ä»¥ç¼–å†™è„šæœ¬è‡ªåŠ¨åŒ–
- âœ… çµæ´»æ§åˆ¶ç”¨æˆ·å±æ€§

---

## æ–¹æ³• 4ï¼šä½¿ç”¨ç®¡ç†è„šæœ¬ï¼ˆæ¨èç”¨äºæ‰¹é‡åˆ›å»ºï¼‰

åˆ›å»ºä¸€ä¸ª Python è„šæœ¬æ¥è‡ªåŠ¨åˆ›å»ºç”¨æˆ·ï¼š

```bash
cd /home/zzb/Quantify/ctos/apps/website
cat > create_users.py << 'EOF'
#!/usr/bin/env python
"""æ‰¹é‡åˆ›å»ºç”¨æˆ·çš„è„šæœ¬"""
import os
import sys
import django

# è®¾ç½® Django ç¯å¢ƒ
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'website.settings')
django.setup()

from django.contrib.auth.models import User

def create_user(username, email, password, is_superuser=False):
    """åˆ›å»ºç”¨æˆ·"""
    if User.objects.filter(username=username).exists():
        print(f"ç”¨æˆ· {username} å·²å­˜åœ¨ï¼Œè·³è¿‡")
        return None
    
    if is_superuser:
        user = User.objects.create_superuser(username, email, password)
    else:
        user = User.objects.create_user(username, email, password)
    
    print(f"âœ“ ç”¨æˆ· {username} åˆ›å»ºæˆåŠŸ")
    return user

if __name__ == '__main__':
    # åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜
    create_user('admin', 'admin@ctos.com', 'admin123', is_superuser=True)
    
    # åˆ›å»ºå…¶ä»–ç”¨æˆ·
    # create_user('user1', 'user1@ctos.com', 'user123')
    # create_user('user2', 'user2@ctos.com', 'user123')
    
    print("\næ‰€æœ‰ç”¨æˆ·åˆ›å»ºå®Œæˆï¼")
EOF

chmod +x create_users.py
python create_users.py
```

---

## ğŸ” ç”¨æˆ·ç®¡ç†æ“ä½œ

### ä¿®æ”¹ç”¨æˆ·å¯†ç 

**æ–¹æ³• 1ï¼šä½¿ç”¨å‘½ä»¤è¡Œ**
```bash
python manage.py changepassword username
```

**æ–¹æ³• 2ï¼šä½¿ç”¨ Django Shell**
```python
from django.contrib.auth.models import User

user = User.objects.get(username='username')
user.set_password('new_password')
user.save()
print("å¯†ç å·²æ›´æ–°")
```

### åˆ é™¤ç”¨æˆ·

```python
from django.contrib.auth.models import User

user = User.objects.get(username='username')
user.delete()
print("ç”¨æˆ·å·²åˆ é™¤")
```

### æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·

```python
from django.contrib.auth.models import User

users = User.objects.all()
for user in users:
    print(f"ç”¨æˆ·å: {user.username}, é‚®ç®±: {user.email}, è¶…çº§ç”¨æˆ·: {user.is_superuser}")
```

### è®¾ç½®ç”¨æˆ·æƒé™

```python
from django.contrib.auth.models import User, Permission

user = User.objects.get(username='username')
# æ·»åŠ ç‰¹å®šæƒé™
permission = Permission.objects.get(codename='add_logentry')
user.user_permissions.add(permission)
user.save()
```

---

## ğŸ“ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ¬¡é…ç½®ç”¨æˆ·

1. **ç¡®ä¿æ•°æ®åº“å·²è¿ç§»**
```bash
cd /home/zzb/Quantify/ctos/apps/website
python manage.py migrate
```

2. **åˆ›å»ºç¬¬ä¸€ä¸ªè¶…çº§ç”¨æˆ·**
```bash
python manage.py createsuperuser
```

3. **å¯åŠ¨æœåŠ¡å™¨å¹¶æµ‹è¯•ç™»å½•**
```bash
python manage.py runserver 0.0.0.0:8000
```

è®¿é—®ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:8000/auth/login/`

---

## ğŸ”’ å®‰å…¨å»ºè®®

1. **å¼ºå¯†ç ç­–ç•¥**
   - è‡³å°‘ 8 ä¸ªå­—ç¬¦
   - åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
   - ä¸è¦ä½¿ç”¨å¸¸è§å¯†ç 

2. **å®šæœŸæ›´æ¢å¯†ç **
   ```bash
   python manage.py changepassword username
   ```

3. **é™åˆ¶è¶…çº§ç”¨æˆ·æ•°é‡**
   - åªç»™å¿…è¦çš„äººå‘˜è¶…çº§ç”¨æˆ·æƒé™
   - æ™®é€šç”¨æˆ·ä½¿ç”¨æ™®é€šè´¦æˆ·

4. **ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯**
   ```python
   # settings.py
   import os
   DEFAULT_ADMIN_PASSWORD = os.environ.get('ADMIN_PASSWORD', 'change_me')
   ```

---

## ğŸ¯ å¸¸è§é—®é¢˜

### Q: å¿˜è®°è¶…çº§ç”¨æˆ·å¯†ç æ€ä¹ˆåŠï¼Ÿ

**A:** ä½¿ç”¨å‘½ä»¤è¡Œé‡ç½®ï¼š
```bash
python manage.py changepassword admin
```

### Q: å¦‚ä½•æ‰¹é‡å¯¼å…¥ç”¨æˆ·ï¼Ÿ

**A:** ä½¿ç”¨ Django Shell æˆ–åˆ›å»ºç®¡ç†è„šæœ¬ï¼ˆè§æ–¹æ³• 4ï¼‰

### Q: å¦‚ä½•ç¦ç”¨ç”¨æˆ·ï¼Ÿ

**A:** åœ¨ Django Shell ä¸­ï¼š
```python
from django.contrib.auth.models import User
user = User.objects.get(username='username')
user.is_active = False
user.save()
```

### Q: å¦‚ä½•æŸ¥çœ‹ç”¨æˆ·ç™»å½•å†å²ï¼Ÿ

**A:** Django é»˜è®¤ä¸è®°å½•ç™»å½•å†å²ï¼Œéœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹åŒ…å¦‚ `django-user-sessions` æˆ–è‡ªå®šä¹‰å®ç°ã€‚

---

## ğŸ“š ç›¸å…³èµ„æº

- [Django ç”¨æˆ·è®¤è¯æ–‡æ¡£](https://docs.djangoproject.com/en/4.2/topics/auth/)
- [Django Admin æ–‡æ¡£](https://docs.djangoproject.com/en/4.2/ref/contrib/admin/)
- [ç”¨æˆ·æƒé™ç®¡ç†](https://docs.djangoproject.com/en/4.2/topics/auth/default/#permissions-and-authorization)

---

**æœ€åæ›´æ–°**: 2024-12-02

